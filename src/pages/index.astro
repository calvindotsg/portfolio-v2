---
import Layout from "../layouts/Layout.astro";
import Card from "../components/Card/index.astro";
import Career from "../components/Career.astro";
import Goal from "../components/Goal.astro";
import IntroCard from "../components/IntroCard.astro";
import AboutMe from "../components/AboutMe.astro";
import Now from "../components/Now.astro";
import {FOOTER, METADATA} from "../lib/constants";
---

<script>
import { animate, stagger, spring } from "motion";

document.addEventListener("DOMContentLoaded", () => {
    const loader = document.querySelector('.loader');
    const cards = document.querySelectorAll('main > *');

    // Set initial states
    if (loader) {
        loader.style.opacity = '1';
    }

    cards.forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(40%)';
    });

    // Animation sequence
    const runAnimations = async () => {
        // 1. Fade out loader (opacity 1 â†’ 0, disable pointer events)
        if (loader) {
            animate(
                loader,
                { opacity: 0 },
                { 
                    duration: 0.5,
                    type: spring,
                    velocity: 100,
                    stiffness: 50,
                    damping: 10
                }
            );

            // Disable pointer events after fade starts
            setTimeout(() => {
                loader.style.pointerEvents = 'none';
            }, 100);
        }

        // 2. Animate cards with stagger (start 0.1s before loader finishes)
        setTimeout(() => {
            animate(
                cards,
                { 
                    opacity: 1,
                    transform: 'translateY(0%)' 
                },
                { 
                    delay: stagger(0.3),
                    duration: 0.4,
                    type: spring,
                    velocity: 100,
                    stiffness: 50,
                    damping: 10
                }
            );
        }, 400); // Start 0.1s before loader finishes (500ms - 100ms)
    };

    runAnimations();
});
</script>

<Layout
        title={METADATA.title}
        description={METADATA.description}
>
    <main
            class="text-[var(--text)] m-auto p-2 grid gap-2 max-w-6xl overflow-hidden relative w-full sm:p-4 sm:gap-2 md:grid-cols-2 md:gap-3 md:p-6 lg:h-screen lg:grid-rows-8 lg:grid-cols-4 lg:gap-4 lg:max-h-[800px]"
    >
        <IntroCard/>
        <Goal/>
        <AboutMe/>
        <Career/>
        <Now/>
        <Card colSpan="md:col-span-1" rowSpan="md:row-span-1">
            <p class="text-xs">
                {FOOTER.footer}
            </p>
        </Card>
    </main>
</Layout>
